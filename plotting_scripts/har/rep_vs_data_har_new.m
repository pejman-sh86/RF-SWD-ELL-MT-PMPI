function [] = rep_vs_data_har_new();
%
%PLOT reflection model and data 
%
paper = 1;
set(0, 'DefaultFigurePaperPosition', [0 0 7 7]);

nlay = 3;
freq = [375 468 562 656 750 843 937 1031 1125 1218 1312 1406];

if(nlay == 2)
m(:,1) = [0.40017019 1558.2125 1.309579 0.63798448       1665.354 ...
2.2     0.69048803]';
m(:,2) = [2.2738691 1613.3531  1.1646904 0.16992997      1792.7975 ...
1.7259953              1]';
m(:,3) = [2.2380163 1591.9867  1.6706305 0.24136153      1733.7092 ...
1.5834949     0.83796347]';
m(:,4) = [2.5693252 1605.6474  1.6992837 0.42142216      1706.6957 ...
1.7973556     0.78580289]';
m(:,5) = [1.0113494 1583.4239  1.2525754 0.27689708      1743.6829 ...
2.2     0.64798825]';
m(:,6) = [0.97278108 1560.5152 1.5418177 0.089635751      1746.6264 ...
2.1999738     0.88464522]';
m(:,7) = [0.95328421 1562.3177 1.6234843 0.072762501      1737.2855 ...
2.2     0.99912306]';
m(:,8) = [1.0014347 1633.6479  1.8 0.82063501      1847.0415 ...
2.1793207     0.53965079]';
m(:,9) = [0.99260768 1634.4159 1.8 0.99615381      1847.2846 ...
2.2     0.46380402]';
m(:,10) = [0.9553998 1632.9019 1.7997609 1      1849.9387 ...
2.1575185      0.9873909]';
m(:,11) = [0.94123398 1631.0428 1.799826 0.99042163      1849.9597 ...
1.7925668     0.83687973]';
m(:,12) = [0.90350016 1627.7066 1.7997558 0.87658109      1843.0137 ...
1.6814732     0.95382063]';
else
m(:,1) = [0.10000828      1580.9125      1.7707042 ...
0.28739342      2.5892129      1572.9857      1.7763138 0.58424697 ...
1801.5068      1.9739564    0.089177351]';
m(:,2) = [1.9347059      1567.0063      1.1166811 ...
0.035399466     0.84225255      1567.2564      1.0878035    0.34148279 ...
1689.5819      2.1266886     0.66498193]';
m(:,3) = [2.5464035      1589.3508      1.6282458 ...
0.29915181       2.425818      1589.5119       1.719114     0.57038475 ...
1802.4445      1.9563693     0.55723589]';
m(:,4) = [1.6897462      1599.8204       1.470942 ...
0.39720597       2.328248      1587.4683       1.396275     0.42547159 ...
1756.5149      1.9753745     0.66790359]';
m(:,5) = [1.5313793      1591.2141       1.592349 ...
0.62302519      2.0172418       1603.304      1.1632248 0.38275006 ...
1719.6605      1.8437329     0.56652517]'; 
m(:,6) = [0.24352861      1548.0665      1.5483984 ...
0.40725462      0.6102346      1542.9847      1.1923163     0.99998225 ...
1768.8141      1.6570435     0.50398225]';
m(:,7) = [0.76150144      1587.1891      1.2625269 ...
0.87798239     0.18014608      1598.7464      1.0017517     0.76228936 ...
1748.9047            2.2     0.25990549]';
m(:,8) = [0.44543755      1514.1889      1.3419333 ...
0.42478525     0.56979784      1625.4936      1.0622764              1 ...
1766.5384      2.1414549     0.58397184]';
m(:,9) = [0.53025158       1506.846      1.5104284 ...
0.26132948     0.42571603      1569.2291      1.2267658     0.5555805 ...
1713.4694      2.0747278     0.73603384]';
m(:,10) = [0.52043153      1579.3977      1.2725755 ...
0.37905105     0.39477929      1531.9684      1.1760991 0.18686529 ...
1690.9042      2.0392435     0.68181513]';
m(:,11) = [0.23474017      1522.7086            1.8 ...
0.24704506     0.60664205      1527.3188      1.5332321 0.57026034 ...
1796.8041       1.608556     0.80959873]';
m(:,12) = [0.63914583      1622.5336      1.6601592 ...
0.78298314      2.9083414      1580.6068      1.0967968     0.37488555 ...
1850      2.0664243     0.76113981]';
end

nfreq = size(m,2);
for i = 1:nfreq
  parfile = strcat('measured_parameters_',num2str(nlay),'_',num2str(freq(i)),'.dat');
  tab = readtextfile(parfile);
  [outfile,F,converg_cov,converg_marg] =...
  convert_parfile(tab);
  extension1 = strcat('rep_data_',num2str(nlay),'_',num2str(freq(i)),'.mat');
  extension2 = strcat('har_data_',num2str(freq(i)),'.mat');
  repfile = strrep(outfile,'sample.dat',extension1);
  harfile = strrep(outfile,'sample.dat',extension2);
  ml_file = strrep(outfile,'sample.dat','ml_std.mat');
  plotfile1 = strrep(outfile,'sample.dat','rep_vs_data.eps');
  [B] = replicate_har(m(:,i),F);
  Frep(i).dat = B(1).dat;
  save(repfile,'B');
  load(harfile);
  Ftmp(i).dat = B(1).dat;
end

for i = 1:nfreq
  F(i).dat = Ftmp(i).dat;
end

figure(1);
if(paper == 1)
  llw = [0.10 0.335 0.57 0.805 0.10 0.335 0.57 0.805 0.10 0.335 0.57 0.805];
  llh = [0.69 0.42 0.15];
else
  llw = [0.15 0.43 0.71 0.15 0.43 0.71 0.15 0.43 0.71];
  llh = [0.69 0.42 0.15];
end
spw = 0.195;
sph = 0.26;

i = 1; j = 1;
for k=1:nfreq
   if k <= 4
     subplot('Position',[llw(i) llh(1) spw sph]);
     i = i + 1;
   elseif k <= 8
     subplot('Position',[llw(i) llh(2) spw sph]);
     i = i + 1;
   else
     subplot('Position',[llw(i) llh(3) spw sph]);
     i = i + 1;
   end
   hold on;box on
   plot(F(1).ang(F(1).astart:F(1).aend), F(k).dat(F(1).astart:F(1).aend),'k.');
   hold on;
   
   if(paper == 1)
     plot(F(1).ang(F(1).astart:F(1).aend),Frep(k).dat(F(1).astart:F(1).aend),'b');
   else
     plot(F(1).ang(F(1).astart:F(1).aend),Frep(k).dat(F(1).astart:F(1).aend),'b');
   end
%   title([num2str(freq(k)) ' Hz'] )
   text(55,0.9,[num2str(freq(k)) ' Hz']);
   axis([0 90 0 1]);
   legend('har','rep'); 
%   if(paper == 1)
%     set(gca,'XTick',[0 30 60 90],'YTick',[0 1],...
%     'YLim',[0 1.1],'FontSize',12);
%   else
%     set(gca,'XTick',[0 40 80],'YTick',[0 1],...
%     'YLim',[0 1.1],'FontSize',16);
%   end
%   if k >=  6;xlabel('Angle [deg]');end
%   if k == 1;ylabel('BL [dB]');end
%   if(k < 6) 
%     set(gca,'XTickLabel',[]);
%   else 
%     if(paper == 1)
%       set(gca,'XTickLabel',[0 30 60 90]);
%     else
%       set(gca,'XTickLabel',[0 40 80]);
%     end
%   end
end
saveas(gca,plotfile1,'epsc2');

return
% ------------------------------------------------------------------------
% ...this is the end my fiend.
% EOF   
